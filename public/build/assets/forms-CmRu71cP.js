class p{constructor(){this.turnstileToken=null,this.assetBaseUrl=null,this.placesKey=null,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.init()):this.init()}init(){this.setupConfig(),this.setupTurnstile(),this.attachValidation(),this.attachVehicleSelection(),this.attachTabSwitching(),this.ensurePlacesReady()}setupConfig(){const e=document.querySelector("[data-places-key], [data-config]");e&&(this.placesKey=e.dataset.placesKey),this.assetBaseUrl=this.getAssetBaseUrl()}getAssetBaseUrl(){const e=document.querySelector('meta[name="asset-url"]');return e?e.content+"/assets/images/cars":"/assets/images/cars"}setupTurnstile(){window.onTurnstileSuccess=e=>{this.turnstileToken=e,this.validateAllForms()},window.onTurnstileError=()=>{this.turnstileToken=null,this.validateAllForms()},window.onTurnstileExpired=()=>{this.turnstileToken=null,this.validateAllForms()}}validateForm(e){if(!e)return;const t=e.querySelector('button[type="submit"], input[type="submit"]');if(!t)return;const s=e.querySelectorAll("input[required], select[required], textarea[required]"),r=Array.from(s).every(a=>a.name==="other_requirements"||a.name==="special_requirements"?!0:a.type==="checkbox"||a.type==="radio"?a.checked:a.name==="phone"?a.value.replace(/\D/g,"").length===10:a.name==="card_number"?a.value.replace(/\D/g,"").length===16:a.name==="cvc"?a.value.replace(/\D/g,"").length===3:a.value&&a.value.toString().trim().length>0),n=!e.querySelector(".cf-turnstile")||this.turnstileToken,i=r&&n;t.disabled=!i,t.classList.toggle("bg-amber-600",i),t.classList.toggle("hover:bg-amber-700",i),t.classList.toggle("bg-slate-300",!i),t.classList.toggle("cursor-not-allowed",!i)}validateAllForms(){document.querySelectorAll("form").forEach(e=>this.validateForm(e))}attachValidation(){document.querySelectorAll("form").forEach(e=>{e.dataset.validationAttached||(e.dataset.validationAttached="true",e.querySelectorAll("input, select, textarea").forEach(t=>{t.addEventListener("input",()=>{if(t.name==="phone"){let s=t.value.replace(/\D/g,"");s.length>10&&(s=s.substring(0,10)),t.value=s}if(t.name==="card_number"){let s=t.value.replace(/\D/g,"");s.length>16&&(s=s.substring(0,16)),t.value=s}if(t.name==="cvc"){let s=t.value.replace(/\D/g,"");s.length>3&&(s=s.substring(0,3)),t.value=s}this.validateForm(e)}),t.addEventListener("change",()=>this.validateForm(e))}),e.addEventListener("submit",t=>{if(!this.turnstileToken&&e.querySelector(".cf-turnstile"))return t.preventDefault(),alert("Please complete the security verification."),!1;if(this.turnstileToken){const s=e.querySelector('input[name="turnstile_token"]');s&&s.remove();const r=document.createElement("input");r.type="hidden",r.name="turnstile_token",r.value=this.turnstileToken,e.appendChild(r)}}),this.validateForm(e))})}attachVehicleSelection(){document.querySelectorAll('select[name="vehicle_type"]').forEach(e=>{if(e.dataset.vehicleAttached)return;e.dataset.vehicleAttached="true";const t=e.closest("form")||e.closest(".vehicle-container")||document,s=t.querySelector(".vehicle-display"),r=t.querySelector(".vehicle-image"),l=t.querySelector(".vehicle-name"),n=t.querySelector(".vehicle-capacity"),i=t.querySelector('select[name="passengers"]'),a=t.querySelector('select[name="suitcases"]');e.addEventListener("change",()=>{const o=e.options[e.selectedIndex];if(o.value&&e.selectedIndex>0){const u=parseInt(o.dataset.passengers),m=parseInt(o.dataset.suitcases),h=o.dataset.image;if(s&&s.classList.remove("hidden"),r&&h&&(r.src=`${this.assetBaseUrl}/${h}`,r.alt=o.value),l&&(l.textContent=o.value),n&&u&&(n.textContent=`Max ${u} passengers`),i&&u){i.disabled=!1,i.classList.remove("bg-slate-100","text-slate-400"),i.classList.add("bg-white","text-slate-900"),i.innerHTML='<option value="" disabled selected>Choose passengers</option>';for(let c=1;c<=u;c++){const d=document.createElement("option");d.value=c,d.textContent=c,i.appendChild(d)}}if(a&&m!==void 0){a.disabled=!1,a.classList.remove("bg-slate-100","text-slate-400"),a.classList.add("bg-white","text-slate-900"),a.innerHTML='<option value="" disabled selected>Choose suitcases</option>';for(let c=0;c<=m;c++){const d=document.createElement("option");d.value=c,d.textContent=c,a.appendChild(d)}}}else s&&s.classList.add("hidden"),i&&(i.disabled=!0,i.classList.add("bg-slate-100","text-slate-400"),i.classList.remove("bg-white","text-slate-900"),i.innerHTML='<option value="">Select vehicle first</option>'),a&&(a.disabled=!0,a.classList.add("bg-slate-100","text-slate-400"),a.classList.remove("bg-white","text-slate-900"),a.innerHTML='<option value="">Select vehicle first</option>');this.validateForm(e.closest("form"))}),i&&(i.disabled=!0),a&&(a.disabled=!0)})}attachTabSwitching(){const e=document.querySelectorAll(".form-tab"),t=document.querySelectorAll(".reservation-form, .quote-form, [data-form]");e.forEach(s=>{s.addEventListener("click",()=>{const r=s.getAttribute("data-form");e.forEach(l=>l.classList.remove("active","border-amber-400","text-amber-700")),s.classList.add("active","border-amber-400","text-amber-700"),t.forEach(l=>{const n=l.getAttribute("data-form")===r;l.classList.toggle("hidden",!n)}),setTimeout(()=>this.validateAllForms(),100)})})}initPlaces(){return!(window.google&&window.google.maps&&window.google.maps.places)||!this.placesKey?!1:(document.querySelectorAll(".location-input").forEach(e=>{if(e.dataset.placesInitialized)return;e.dataset.placesInitialized="true";const t=e.parentElement?.querySelector(".place-id"),s=new window.google.maps.places.Autocomplete(e,{types:["address"],componentRestrictions:{country:"us"},fields:["place_id","formatted_address","address_components","geometry"]});s.addListener("place_changed",()=>{const r=s.getPlace();if(!r.place_id){t&&(t.value="");return}t&&(t.value=r.place_id);let l="";if(r.address_components){const n={};r.address_components.forEach(a=>{a.types.forEach(o=>{n[o]=a.long_name})});const i=[];n.street_number&&n.route?i.push(`${n.street_number} ${n.route}`):n.route&&i.push(n.route),(n.locality||n.sublocality_level_1)&&i.push(n.locality||n.sublocality_level_1),n.administrative_area_level_1&&i.push(n.administrative_area_level_1),n.postal_code&&i.push(n.postal_code),l=i.join(", ")}e.value=l||r.formatted_address||e.value,this.validateForm(e.closest("form"))}),e.addEventListener("input",()=>{t&&(t.value=""),this.validateForm(e.closest("form"))})}),!0)}ensurePlacesReady(e=0){this.initPlaces()||e<20&&setTimeout(()=>this.ensurePlacesReady(e+1),200)}}window.royalCarriageForms=new p;window.initFormPlaces=()=>{window.royalCarriageForms&&window.royalCarriageForms.ensurePlacesReady()};window.initQuoteFormPlaces=window.initFormPlaces;window.initReservationPlaces=window.initFormPlaces;
