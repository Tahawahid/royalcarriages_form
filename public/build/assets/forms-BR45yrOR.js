class p{constructor(){this.turnstileToken=null,this.assetBaseUrl=null,this.placesKey=null,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.init()):this.init()}init(){this.setupConfig(),this.setupTurnstile(),this.attachValidation(),this.attachVehicleSelection(),this.attachTabSwitching(),this.ensurePlacesReady()}setupConfig(){const e=document.querySelector("[data-places-key], [data-config]");e&&(this.placesKey=e.dataset.placesKey),this.assetBaseUrl=this.getAssetBaseUrl()}getAssetBaseUrl(){const e=document.querySelector('meta[name="asset-url"]');return e?e.content+"/assets/images/cars":"/assets/images/cars"}setupTurnstile(){window.onTurnstileSuccess=e=>{this.turnstileToken=e,this.validateAllForms()},window.onTurnstileError=()=>{this.turnstileToken=null,this.validateAllForms()},window.onTurnstileExpired=()=>{this.turnstileToken=null,this.validateAllForms()}}validateForm(e){if(!e)return;const t=e.querySelector('button[type="submit"], input[type="submit"]');if(!t)return;const r=e.querySelectorAll("input[required], select[required], textarea[required]"),l=Array.from(r).every(i=>i.type==="checkbox"||i.type==="radio"?i.checked:i.value&&i.value.toString().trim().length>0),a=!e.querySelector(".cf-turnstile")||this.turnstileToken,s=l&&a;t.disabled=!s,t.classList.toggle("bg-amber-600",s),t.classList.toggle("hover:bg-amber-700",s),t.classList.toggle("bg-slate-300",!s),t.classList.toggle("cursor-not-allowed",!s)}validateAllForms(){document.querySelectorAll(".reservation-form").forEach(e=>this.validateForm(e))}attachValidation(){document.querySelectorAll(".reservation-form").forEach(e=>{e.dataset.validationAttached||(e.dataset.validationAttached="true",e.querySelectorAll("input, select, textarea").forEach(t=>{t.addEventListener("input",()=>this.validateForm(e)),t.addEventListener("change",()=>this.validateForm(e))}),e.addEventListener("submit",t=>{if(!this.turnstileToken&&e.querySelector(".cf-turnstile"))return t.preventDefault(),alert("Please complete the security verification."),!1;if(this.turnstileToken){const r=e.querySelector('input[name="turnstile_token"]');r&&r.remove();const l=document.createElement("input");l.type="hidden",l.name="turnstile_token",l.value=this.turnstileToken,e.appendChild(l)}}),this.validateForm(e))})}attachVehicleSelection(){document.querySelectorAll('select[name="vehicle_type"]').forEach(e=>{if(e.dataset.vehicleAttached)return;e.dataset.vehicleAttached="true";const t=e.closest("form")||e.closest(".vehicle-container")||document,r=t.querySelector(".vehicle-display"),l=t.querySelector(".vehicle-image"),o=t.querySelector(".vehicle-name"),a=t.querySelector(".vehicle-capacity"),s=t.querySelector('select[name="passengers"]'),i=t.querySelector('select[name="suitcases"]');e.addEventListener("change",()=>{const c=e.options[e.selectedIndex];if(c.value&&e.selectedIndex>0){const u=parseInt(c.dataset.passengers),m=parseInt(c.dataset.suitcases),h=c.dataset.image;if(r&&r.classList.remove("hidden"),l&&h&&(l.src=`${this.assetBaseUrl}/${h}`,l.alt=c.value),o&&(o.textContent=c.value),a&&u&&(a.textContent=`Max ${u} passengers`),s&&u){s.disabled=!1,s.classList.remove("bg-slate-100","text-slate-400"),s.classList.add("bg-white","text-slate-900"),s.innerHTML='<option value="" disabled selected>Choose passengers</option>';for(let n=1;n<=u;n++){const d=document.createElement("option");d.value=n,d.textContent=n,s.appendChild(d)}}if(i&&m!==void 0){i.disabled=!1,i.classList.remove("bg-slate-100","text-slate-400"),i.classList.add("bg-white","text-slate-900"),i.innerHTML='<option value="" disabled selected>Choose suitcases</option>';for(let n=0;n<=m;n++){const d=document.createElement("option");d.value=n,d.textContent=n,i.appendChild(d)}}}else r&&r.classList.add("hidden"),s&&(s.disabled=!0,s.classList.add("bg-slate-100","text-slate-400"),s.classList.remove("bg-white","text-slate-900"),s.innerHTML='<option value="">Select vehicle first</option>'),i&&(i.disabled=!0,i.classList.add("bg-slate-100","text-slate-400"),i.classList.remove("bg-white","text-slate-900"),i.innerHTML='<option value="">Select vehicle first</option>');this.validateForm(e.closest("form"))}),s&&(s.disabled=!0),i&&(i.disabled=!0)})}attachTabSwitching(){const e=document.querySelectorAll(".form-tab"),t=document.querySelectorAll(".reservation-form, .quote-form");e.forEach(r=>{r.addEventListener("click",()=>{const l=r.getAttribute("data-form");e.forEach(o=>o.classList.remove("active","border-amber-400","text-amber-700")),r.classList.add("active","border-amber-400","text-amber-700"),t.forEach(o=>{const a=o.getAttribute("data-form")===l;o.classList.toggle("hidden",!a)}),setTimeout(()=>this.validateAllForms(),100)})})}initPlaces(){return!(window.google&&window.google.maps&&window.google.maps.places)||!this.placesKey?!1:(document.querySelectorAll(".location-input").forEach(e=>{if(e.dataset.placesInitialized)return;e.dataset.placesInitialized="true";const t=e.parentElement?.querySelector(".place-id"),r=new window.google.maps.places.Autocomplete(e,{types:["address"],componentRestrictions:{country:"us"},fields:["place_id","formatted_address","address_components","geometry"]});r.addListener("place_changed",()=>{const l=r.getPlace();if(!l.place_id){t&&(t.value="");return}t&&(t.value=l.place_id);let o="";if(l.address_components){const a={};l.address_components.forEach(i=>{i.types.forEach(c=>{a[c]=i.long_name})});const s=[];a.street_number&&a.route?s.push(`${a.street_number} ${a.route}`):a.route&&s.push(a.route),(a.locality||a.sublocality_level_1)&&s.push(a.locality||a.sublocality_level_1),a.administrative_area_level_1&&s.push(a.administrative_area_level_1),a.postal_code&&s.push(a.postal_code),o=s.join(", ")}e.value=o||l.formatted_address||e.value,this.validateForm(e.closest("form"))}),e.addEventListener("input",()=>{t&&(t.value=""),this.validateForm(e.closest("form"))})}),!0)}ensurePlacesReady(e=0){this.initPlaces()||e<20&&setTimeout(()=>this.ensurePlacesReady(e+1),200)}}window.royalCarriageForms=new p;window.initFormPlaces=()=>{window.royalCarriageForms&&window.royalCarriageForms.ensurePlacesReady()};window.initQuoteFormPlaces=window.initFormPlaces;window.initReservationPlaces=window.initFormPlaces;
